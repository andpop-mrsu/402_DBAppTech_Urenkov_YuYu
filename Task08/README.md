# Task08 — веб-приложение «Guess Number» на PHP + SQLite

Данное задание развивает предыдущие лабораторные работы (Task06 и Task07), в которых была реализована игра «Угадай число» сначала как браузерное приложение с хранением данных в IndexedDB. В Task08 игра переведена на архитектуру «клиент–сервер» с использованием PHP и СУБД SQLite.

Клиентская часть (SPA на JavaScript) взаимодействует с сервером по REST API, серверная часть реализует доступ к базе данных и хранит сведения о сыгранных партиях.

---

## Функциональные требования

Игра реализует классическую задачу «Угадай число»:

- Компьютер загадывает число в диапазоне от 1 до максимального числа (задаётся в настройках).
- Игрок вводит предполагаемое число.
- После каждой попытки приложение сообщает, больше или меньше загаданного введённое число.
- Ограничение по количеству попыток задаётся в настройках (может быть отключено).

Для каждой партии в базе данных сохраняется:

- дата и время начала и окончания партии;
- имя игрока;
- минимальное и максимальное числа диапазона;
- загаданное компьютером число;
- исход игры (победа / поражение);
- количество попыток;
- ограничение по попыткам (если было включено);
- список всех ходов в формате:
  **номер попытки | предложенное число | ответ компьютера**.

Реализованы следующие режимы работы:

1. **Новая игра** — запуск новой партии.
2. **Вывод списка всех игр** — отображение всех сохранённых партий.
3. **Вывод списка игр с победами** — фильтрация партий, в которых игрок победил.
4. **Вывод списка игр с поражениями** — фильтрация партий, в которых игрок проиграл.
5. **Вывод статистики по игрокам** — для каждого игрока считаются количество побед и поражений, список сортируется по числу побед (чемпионы вверху).
6. **Повтор сохранённой партии** — воспроизведение всех ходов выбранной партии по её ID.

Дополнительно реализована функция **очистки базы данных** для удобства отладки.

---

## Используемые технологии

**Клиент (frontend)**

- HTML5, CSS3
- JavaScript (ES6-модули)
- Архитектура, близкая к MVC:
  - `Game.js` — игровая логика;
  - `View.js` — работа с DOM, отрисовка интерфейса;
  - `Controller.js` — связь логики, UI и доступа к данным;
  - `Database.js` — слой доступа к данным (REST-клиент).

**Сервер (backend)**

- PHP 8+
- SQLite (файл базы данных в каталоге `db/`)
- Встроенный веб-сервер PHP (`php -S`)
- Шаблон **Front Controller**: все запросы проходят через `public/index.php`.

---

## Структура проекта (Task08)

```text
Task08/
  public/
    index.html          # Single Page Application (интерфейс игры)
    styles.css          # Оформление
    index.php           # Front Controller + REST API
    src/
      Game.js           # Игровая логика «Угадай число»
      View.js           # Работа с DOM, отрисовка интерфейса
      Controller.js     # Режимы игры, связь логики, UI и REST
      Database.js       # REST-клиент к PHP/SQLite
  db/
    guess-number.sqlite # Файл БД SQLite (создаётся автоматически)
```

Все статические файлы (HTML, CSS, JS) находятся в каталоге `public`.
База данных — в каталоге `db`.

---

## REST API

Сервер предоставляет минималистичный JSON API.

### Получение списка всех игр

```http
GET /games
```

**Ответ (JSON):** массив объектов:

```json
[
  {
    "id": 1,
    "startedAt": 1700000000000,
    "finishedAt": 1700000012345,
    "durationMs": 12345,
    "playerName": "Иван",
    "min": 1,
    "max": 100,
    "target": 42,
    "attemptLimit": 10,
    "attempts": 5,
    "win": true
  }
]
```

Используется для отображения:

- всех партий;
- только побед;
- только поражений (фильтрация выполняется на клиенте).

---

### Получение информации об одной игре и её ходах

```http
GET /games/{id}
```

**Ответ (JSON):**

```json
{
  "id": 1,
  "startedAt": 1700000000000,
  "finishedAt": 1700000012345,
  "durationMs": 12345,
  "playerName": "Иван",
  "min": 1,
  "max": 100,
  "target": 42,
  "attemptLimit": 10,
  "attempts": 5,
  "win": true,
  "guesses": [
    { "stepNumber": 1, "value": 10, "result": "low", "ts": 1700000001000 },
    { "stepNumber": 2, "value": 80, "result": "high", "ts": 1700000002000 },
    { "stepNumber": 3, "value": 42, "result": "correct", "ts": 1700000003000 }
  ]
}
```

Используется в режиме **повтора партии**.

---

### Сохранение итогов партии

```http
POST /games
Content-Type: application/json
```

**Тело запроса (JSON):**

```json
{
  "playerName": "Иван",
  "min": 1,
  "max": 100,
  "target": 42,
  "attemptLimit": 10,
  "attempts": 5,
  "startedAt": 1700000000000,
  "finishedAt": 1700000012345,
  "durationMs": 12345,
  "win": true
}
```

**Ответ (JSON):**

```json
{ "id": 1 }
```

Полученный `id` используется для записи ходов и дальнейшего воспроизведения партии.

---

### Сохранение одного хода партии

```http
POST /step/{id}
Content-Type: application/json
```

Где `{id}` — идентификатор игры, полученный при `POST /games`.

**Тело запроса (JSON):**

```json
{
  "stepNumber": 1,
  "value": 10,
  "result": "low",
  "ts": 1700000001000
}
```

- `result` — одно из: `"low"`, `"high"`, `"correct"`.

---

### Очистка базы данных (опциональный метод для отладки)

```http
DELETE /games
```

Удаляет все игры и все ходы, сбрасывает счётчики автоинкремента.

---

## База данных

Используется СУБД **SQLite**. При первом запуске приложения создаются две таблицы:

```sql
CREATE TABLE games (
    id             INTEGER PRIMARY KEY AUTOINCREMENT,
    started_at     INTEGER NOT NULL,
    finished_at    INTEGER NOT NULL,
    duration_ms    INTEGER NOT NULL,
    player_name    TEXT    NOT NULL,
    min_number     INTEGER NOT NULL,
    max_number     INTEGER NOT NULL,
    target_number  INTEGER NOT NULL,
    attempt_limit  INTEGER,
    attempts       INTEGER NOT NULL,
    win            INTEGER NOT NULL -- 0/1
);

CREATE TABLE steps (
    id           INTEGER PRIMARY KEY AUTOINCREMENT,
    game_id      INTEGER NOT NULL,
    step_number  INTEGER NOT NULL,
    value        INTEGER NOT NULL,
    result       TEXT    NOT NULL,
    created_at   INTEGER NOT NULL,
    FOREIGN KEY (game_id) REFERENCES games(id) ON DELETE CASCADE
);
```

---

## Запуск приложения

1. Перейти в каталог задания:

```bash
cd Task08
```

2. Запустить встроенный веб-сервер PHP:

```bash
php -S localhost:3000 -t public public/index.php
```

3. Открыть браузер и перейти по адресу:

- http://localhost:3000/или
- http://localhost:3000/index.html

При первом запуске автоматически создаётся файл базы данных:

```text
Task08/db/guess-number.sqlite
```
